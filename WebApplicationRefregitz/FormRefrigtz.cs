/***********************************************************************************************
 * Main class of Form Inherited of Form Main in the C#.*****************************************
 * Ramin Edjlal*******************************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Mouse Event Handling Error*****************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Some Soldiers Loos Location  And Virutuallization at Click*********************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Some Codes Lines Frizes********************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Hit things Abnormal behaviour**************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Virtualization Things Error****************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * No Reason Logically For Equality of 'SoldierP' and 'Soldier'*******************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Problem of Sameness of Hit Enemys Solved.No Reason For Equality of 'Soldier' and 'SoldierP'RS--************(-+)
 * No Problem For Hiting**********************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Bridges of Gray Color Conversion to Kings Brown********************************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * Bridges Conversion To King Brown Abnormally no Reasonably**********************************CU*****0.88**1**Risk Control************************(*)
 * Color Conversion In Virtualization Hit Enemy***********************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Need To Find Enemy Detection on Current OrderPlate*****************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * CheckMate an Check Dosn't Work*******************************************************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * No Movments By Computer********************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Illegal Virtualization. The Thinking By 'Alice' (My Computer) ChessRules Misleading********RS*****0.12**4**Managements and Cuation Programing**(+)
 * permutative Constant Huristic Results******************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * In Existence of Adding Suported Huristic Constant Huristic Result Detection****************RS*****0.12**4**Managements and Cuation Programing**(+)
 * OrderPlate Not Configured******************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Non Color Hourse Hit Assignment Misleading(Abnormal)***************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Undetected Error Table Content Malfunction*************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * MalFunction Movments Greate than 5 by 'Alice'.*********************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * 'Check' Second Time 'Alice' MalFanction*****************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * 'Check' 'Alice' Mechnisam Failure***********************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 '* CheckMate' of Unsatisfied in 'Alice'***********************************************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * CheckMate Dosn't Recognized.********************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Virtualization Filed (Not Responding) at Indpencdency State********************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Unable To Draw Refrigtz.Timer  Content at Tow Picture Box*******************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Refrigtz.Timer Working Hardly.**********************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Dead Lock In Drawing Images.***************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Misleading Thread OrderPlate And Time Sharing**********************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Thinkings Taking a lot of Time.************************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * AntiVirus Protextion and Existance Caused to Reduce Speed of Thinking and lead to Lose.****RS*****0.12**4**Managements and Cuation Programing**(+)
 * No Programatically Reason For Speed Reduction.*********************************************RS*****0.12**4**Managements and Cuation Programing**(+) 
 * Mybe Windows Filrewall Has no been correctly Arranges to reduce speed.*********************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Method on Leave not Work.******************************************************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * OrderPlate Reader Table MalFunction.*******************************************************RS*****0.12**4**Managements and Cuation Programing**(+)
 * Wrong Sysntax To Read.*********************************************************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * Some Tables of Hitting Tow Person Are Missing.*********************************************__**************(_)
 * Some Syntaxes at Table Read Are Missing.***************************************************__**************(_)
 * Chess Refregitz Sometimes Not Responding due to Cpu Power Non Ability.*********************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * Chess Refregitz Sometimes stop working.****************************************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * 1395/1/16**********************************************************************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * OrderPlate MalFunction.********************************************************************RS*****0.12**4**Managements and Cuation Programing**{+}
 * Virtualization Error.No Reason For MalFunctionla Operation of Program at Sysntax and Orde.*CU*****0.88**1**Risk Control************************{*}QC-OK.
 * Cause Sensitive Problems of 'Check' And 'CheckMate By 'Alice' is borring at StateCP.*************CU*****0.88**1**Risk Control************************{*}QC-OK.
 * Table Content Misleading.******************************************************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * Documentation Faulting On Removing Detials.************************************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * Loading Games  to Continue failed Unreasonly.**********************************************CU*****0.88**1**Risk Control************************<*>QC-OK.
 * "Thread is dead.The state can not be accessed.".*******************************************CU*****0.88**1**Risk Control************************{*}QC-OK.
 * Illegal Syntax Mechanisam Detection By Genetic Algorithm.**********************************CU*****0.88**1**Risk Control************************<*>QC-Ok.
 * 'MaxCurrentMovmentsNumber' Changes Illegal to Reduced.*************************************CU*****0.88**1**Risk Control************************{*}QC-OK.
 * Arranagment Up-Down Changes caused to Born of Some Objects UnSupported Attractively.*******CU*****0.88**1**Risk Control************************(*)QC-OK.
 * Table TableListAction Genetic Algorithm MalFunctionally Illegal Data.**********************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * Bridges King Insertion Overllaping Previous Enemy Movments of Person Movments.*************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * Statisticer Loader and Acter Bridges King Overview Failed.*********************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * Bridges King Continue With Illegal Movments at Statisticer.********************************CU*****0.88**1**Risk Control************************(*)QC-OK.
 * Calling of All Events From Pressing a Single Button.Mal Function of Database Leading.******CU*****0.88**1**Risk Control************************<*>
 * ***********************************************************************************************************
 * ***********************************************************************************************************
 */


using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Diagnostics;
using System.Threading;
using System.Data.OleDb;
using System.Media;
using System.IO;


[assembly: CLSCompliant(true)]


namespace RefrigtzW
{
    //Constructor
    public partial class FormRefrigtz
    {

        //Initiate Global Variable.
        //public bool DisableTemporarlyTimerUpdate = false;
        public static double MaxHuristicx = Double.MinValue;
        public static bool MovementsAStarGreedyHuristicFound = false;
        public static bool IInoreSelfObjects = false;
        public static bool UsePenaltyRegardMechnisam = true;
        public static bool BestMovments = false;
        public static bool PredictHuristic = true;
        public static bool OnlySelf = false;
        public static bool AStarGreedyHuristic = false;
        bool IsPenaltyRegardCanceled = false;
        WebApplicationRefregitzTow._Default ttt = null;
        public static bool LoadPlaceHolder = true;
        public bool PlaceHolderBreak = false;
        public static bool ThinkingA = false;
        public static bool ReadF = false;
        public static OleDbConnection bookConn = null;
        public static OleDbCommand oleDbCmd = new OleDbCommand();
        public static OleDbCommand oleDbCmdUser = new OleDbCommand();
         bool BobWithStockfishFinished = false;
        bool Stockfish = false;
        bool RefregitzisCurrent = true;
        bool SettingPRFALSE = false;
        public static bool ProfesionalWithComputer = false;
        public bool TimersSet = true;
        public static bool GameStarted = false;
        public static bool ArrangmentsChanged = true;
        public static int MaxCurrentMovmentsNumber = 1;
        public static bool ErrorTrueMonitorFalse = true;
        Thread tM = null;
        bool Clicked = true;
        public static int MaxAStarGreedyHuristicProgress = 0;
        public static String Root = System.Web.HttpRuntime.AppDomainAppPath;
        public bool MouseClicked = false;
        public static bool Blitz = false;
        DateTime PreviousTime;
        static bool LoadAG = false;
        static bool _1 = false;
        static bool _2 = false;
        static bool _3 = false;
        static bool _4 = false;
        static bool Hideag = false;
        bool exit = false;
        bool AllDrawLoad = false;
        Thread AllOperate = null;
        static bool Paused = false;
        static bool UpdateConfigurationTableVal = false;
        static bool NewTable = false;
        Image TimerImage = null;
        Graphics g1 = null;
        Image TimerImage1 = null;
        Graphics g2 = null;
        Graphics g = null;
        Image ChessTable = null;
        public static int LastRow = -1;
        public static int LastColumn = -1;
        Thread t1 = null;
        Thread t2 = null;
        Thread t3 = null;
        Thread t4 = null;
        Thread TTimerSet;
        public static bool LoadedTable = false;
        bool GrayWinner = false;
        bool BrownWiner = false;
        public Refrigtz.Timer TimerText = null;
        public Refrigtz.Timer GrayTimer = null;
        public Refrigtz.Timer BrownTimer = null;
        public static int MovmentsNumber = 0;
        public static bool EndOfGame = false;
        bool Maximize = false;
        static int RowP = 0, ColP = 0, RowS = 0, ColS = 0;
        bool BobSection = true;
        bool AliceSection = false;
        public static bool Person = true;
        static int CurrentKind = 0;
        public static bool StateCC = false;//Computer With Computer
        public static bool StateCP = false;//Person With Computer
        public static bool StateGe = false;//For Genetic Games.
        AllDraw Draw;
        public static int OrderPlate = 1;
        // int AllDraw.MouseClick;
        int Soldier;
        int Elefant;
        int Hourse;
        int Bridge;
        int Minister;
        int King;
        float RowClickP = -1, ColumnClickP = -1;
        int RowClick = -1, ColumnClick = -1;
        float RowRealesedP = -1, ColumnRealeasedP = -1;
        float RowRealesed = -1, ColumnRealeased = -1;
        public static int[,] Table = new int[8, 8];
        FormRefrigtz THIs = null;
        //Error Handling.
        static void Log(Exception ex)
        {
            try
            {
                string stackTrace = ex.ToString();
                File.AppendAllText(Root + "\\ErrorProgramRun.txt", stackTrace + ": On" + DateTime.Now.ToString()); // path of file where stack trace will be stored.
            }
            catch (Exception t) {  }
        }
        //Constructor No2
        public FormRefrigtz(bool AllDra)
        {

            AllDrawLoad = AllDra;

            if (!AllDrawLoad)
            {

                t1 = new Thread(new ThreadStart(AliceWithPerson));
          
            }


            THIs = this;
            Draw = new AllDraw(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged, ref THIs);

            if (!AllDrawLoad)
            {
                BrownTimer = new Refrigtz.Timer(false);
                GrayTimer = new Refrigtz.Timer(false);
                TimerText = new Refrigtz.Timer(true);

                BrownTimer.TimerInitiate();
                GrayTimer.TimerInitiate();
                TTimerSet = new Thread(new ThreadStart(SetTimer));
                TTimerSet.Start();

                TimerText.TimerInitiate();

                TimerText.StartTime();
            }
           
            if (!AllDrawLoad)
            {
                for (int i = 0; i < 8; i++)
                    for (int j = 0; j < 8; j++)
                    {
                        Table[i, j] = 0;
                    }

                for (int i = 0; i < 8; i++)
                    Table[i, 1] = 1;

                for (int i = 8; i < 16; i++)
                    Table[i - 8, 6] = -1;
                Table[2, 0] = 2;
                Table[5, 0] = 2;
                Table[2, 7] = -2;
                Table[5, 7] = -2;

                Table[1, 0] = 3;
                Table[6, 0] = 3;
                Table[1, 7] = -3;
                Table[6, 7] = -3;

                Table[0, 0] = 4;
                Table[7, 0] = 4;
                Table[0, 7] = -4;
                Table[7, 7] = -4;

                Table[3, 0] = 6;
                Table[3, 7] = -6;

                Table[4, 0] = 5;
                Table[4, 7] = -5;
            }
            for (int i = 0; i < 8; i++)
                for (int j = 0; j < 8; j++)
                {
                    AllDraw.TableVeryfy[i, j] = Table[i, j];
                    AllDraw.TableVeryfyConst[i, j] = Table[i, j];
                }
            if (!AllDrawLoad)
            {
                AllDraw.TableListAction.Add(Table);
            }
            for (int i = 0; i < 8; i++)
            {
                Draw.SolderesOnTable[i] = new DrawSoldier(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,i, 1, Color.Gray, Table, 1, false, i);
            }
            for (int i = 8; i < 16; i++)
            {
                Draw.SolderesOnTable[i] = new DrawSoldier(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,i - 8, 6, Color.Brown, Table, -1, false, i);
            }
            Draw.ElephantOnTable[0] = new DrawElefant(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,2, 0, Color.Gray, Table, 1, false, 0);
            Draw.ElephantOnTable[1] = new DrawElefant(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,5, 0, Color.Gray, Table, 1, false, 1);
            Draw.ElephantOnTable[2] = new DrawElefant(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,2, 7, Color.Brown, Table, -1, false, 2);
            Draw.ElephantOnTable[3] = new DrawElefant(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,5, 7, Color.Brown, Table, -1, false, 3);

            Draw.HoursesOnTable[0] = new DrawHourse(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,1, 0, Color.Gray, Table, 1, false, 0);
            Draw.HoursesOnTable[1] = new DrawHourse(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,6, 0, Color.Gray, Table, 1, false, 1);
            Draw.HoursesOnTable[2] = new DrawHourse(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,1, 7, Color.Brown, Table, -1, false, 2);
            Draw.HoursesOnTable[3] = new DrawHourse(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,6, 7, Color.Brown, Table, -1, false, 3);

            Draw.BridgesOnTable[0] = new DrawBridge(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,0, 0, Color.Gray, Table, 1, false, 0);
            Draw.BridgesOnTable[1] = new DrawBridge(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,7, 0, Color.Gray, Table, 1, false, 1);
            Draw.BridgesOnTable[2] = new DrawBridge(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,0, 7, Color.Brown, Table, -1, false, 2);
            Draw.BridgesOnTable[3] = new DrawBridge(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,7, 7, Color.Brown, Table, -1, false, 3);

            Draw.KingOnTable[0] = new DrawKing(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,3, 0, Color.Gray, Table, 1, false, 0);
            Draw.KingOnTable[1] = new DrawKing(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,3, 7, Color.Brown, Table, -1, false, 1);

            Draw.MinisterOnTable[0] = new DrawMinister(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,4, 0, Color.Gray, Table, 1, false, 0);
            Draw.MinisterOnTable[1] = new DrawMinister(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,4, 7, Color.Brown, Table, -1, false, 1);


            AllDraw.TableListAction.Add(Table);
            if (WebApplicationRefregitzTow._Default.First && MovmentsNumber == 0)
            {
                for (int i = 0; i < 8; i++)
                    for (int j = 0; j < 8; j++)
                        Table[i, j] *= -1;
            }
            Draw.TableList.Clear();
            Draw.TableList.Add(Table);
            Draw.SetRowColumn(0);
            //TakeRoot.CalculateRootGray(Draw);
        }
        //Acccess Point
        public AllDraw accessDraw
        {
            get { return Draw; }
            set { Draw = value; }

        }
        //Syncronization Between Class Dlls.
        private void SetTimer()
        {
            do
            {
                //while (!StateCC && !StateCP && !StateGe)
                Thread.Sleep(50);
                Refrigtz.Timer.AStarGreadyFirstSearch = AllDraw.AStarGreadyFirstSearch;
                Refrigtz.Timer.AStarGreedytiLevelMax = AllDraw.AStarGreedyiLevelMax;
                Refrigtz.Timer.UseDoubleTime = AllDraw.UseDoubleTime;
                Refrigtz.Timer.StoreAllDrawCount = AllDraw.StoreADraw.Count;
            }
            while (true);

        }

        //Boolean Setting of Illustration at Slected Object Rules.
        bool[,] VeryFye(int[,] Table, int Order, Color a)
        {
            int Cdummy = ChessRules.CurrentOrder;
            if (OrderPlate == 1)
                ChessRules.CurrentOrder = 1;
            else
                ChessRules.CurrentOrder = -1;
            bool[,] Tab = new bool[8, 8];
            for (int i = 0; i < 8; i++)
                for (int j = 0; j < 8; j++)
                {
                    if ((new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,Table[(int)RowClickP, (int)ColumnClickP], Table, Order, (int)RowClickP, (int)ColumnClickP)).Rules((int)RowClickP, (int)ColumnClickP, i, j, a, Table[(int)RowClickP, (int)ColumnClickP]))
                    {
                        Tab[i, j] = true;
                    }
                }
            ChessRules.CurrentOrder = Cdummy;
            return Tab;
        }
           //Load Refregitz Form.
        //Reading Table Database.
        int[,] ReadTable(int Movment, ref int MoveNumber)
        {

            ChessRules.BridgeActBrown = false;
            bool OneIncreament = false;
            int[,] Tab = Table;
            int Move = 0;
            AllDraw.TableListAction.Clear();
            do
            {
            Again:
                try
                {

                    String connParam = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + Root + "\\" + "Database\\CurrentBank.accdb;Persist Security Info=true;Jet OLEDB:Database Password=''";
                    bookConn = new OleDbConnection(connParam);
                    bookConn.Open();
                    oleDbCmd.Connection = bookConn;
                    String TableName = Move.ToString();
                    String Zero = "Table";
                    for (int i = 0; i < 8 - TableName.Length; i++)
                        Zero += "0";
                    TableName = Zero + TableName;

                    oleDbCmd.CommandText = "Select * From " + TableName;
                    OleDbDataReader dr = null;
                    dr = oleDbCmd.ExecuteReader();
                    int ii = 0;
                    while (dr.Read())
                    {
                        Tab[0, ii] = System.Convert.ToInt32(dr["a"]);
                        Tab[1, ii] = System.Convert.ToInt32(dr["b"]);
                        Tab[2, ii] = System.Convert.ToInt32(dr["c"]);
                        Tab[3, ii] = System.Convert.ToInt32(dr["d"]);
                        Tab[4, ii] = System.Convert.ToInt32(dr["e"]);
                        Tab[5, ii] = System.Convert.ToInt32(dr["f"]);
                        Tab[6, ii] = System.Convert.ToInt32(dr["g"]);
                        Tab[7, ii] = System.Convert.ToInt32(dr["h"]);
                        ii++;
                    }
                    int[,] TableA = new int[8, 8];
                    for (int i = 0; i < 8; i++)
                        for (int j = 0; j < 8; j++)
                            TableA[i, j] = Tab[i, j];
                    MaxCurrentMovmentsNumber++;
                    Draw.TableList.Clear();
                    Draw.TableList.Add(TableA);
                    Draw.SetRowColumn(0);
                    AllDraw.TableListAction.Add(TableA);

                    if (AllDraw.TableListAction.Count > 1)
                    {
                        ChessGeneticAlgorithm R = new ChessGeneticAlgorithm(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged);
                        if (R.FindGenToModified(AllDraw.TableListAction[AllDraw.TableListAction.Count - 2], AllDraw.TableListAction[AllDraw.TableListAction.Count - 1], AllDraw.TableListAction, 0, OrderPlate, true))
                        {
                            bool HitVal = false;
                            int Hit = AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRow, R.CromosomColumn];
                            if (Hit != 0)
                                HitVal = true;
                            bool Convert = false;
                            if (OrderPlate == 1)
                            {
                                if (AllDraw.TableListAction[AllDraw.TableListAction.Count - 1][R.CromosomRow, R.CromosomColumn] == 1)
                                {
                                    if (R.CromosomColumn == 7)
                                        Convert = true;
                                }
                                if ((ChessRules.SmallKingBridgeGray || ChessRules.BigKingBridgeGray) && (!ChessRules.BridgeActGray))
                                    ChessRules.BridgeActGray = true;
                                AllDraw.SyntaxToWrite = (new ChessRules(MovementsAStarGreedyHuristicFound, IInoreSelfObjects, UsePenaltyRegardMechnisam, BestMovments, PredictHuristic, OnlySelf, AStarGreedyHuristic, ArrangmentsChanged)).CreateStatistic(ArrangmentsChanged, TableA, MoveNumber + 1, AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst], R.CromosomColumn, R.CromosomRow, HitVal, Hit, ChessRules.BridgeActGray, Convert);
                            }
                            else
                            {
                                if (AllDraw.TableListAction[AllDraw.TableListAction.Count - 1][R.CromosomRow, R.CromosomColumn] == -1)
                                {
                                    if (R.CromosomColumn == 0)
                                        Convert = true;
                                }
                                if ((ChessRules.SmallKingBridgeBrown || ChessRules.BigKingBridgeBrown) && (!ChessRules.BridgeActBrown))
                                    ChessRules.BridgeActBrown = true;

                                AllDraw.SyntaxToWrite = (new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged)).CreateStatistic(ArrangmentsChanged,TableA, MoveNumber + 1, AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst], R.CromosomColumn, R.CromosomRow, HitVal, Hit, ChessRules.BridgeActBrown, Convert);
                            }

                        }
                    }


                    Move++;
                    if (Move > 2)
                        GameStarted = true;
                    if (Move > 1)
                        MoveNumber++;

                    for (int i = 0; i < 8; i++)
                        for (int j = 0; j < 8; j++)
                            TableA[i, j] = Tab[i, j];


                    if ((new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,1, TableA, OrderPlate, -1, -1).CheckMate(TableA, OrderPlate)))
                    {
                        int iii = 0;
                        do { iii++; } while (System.IO.File.Exists(Root + "\\Database\\Games\\CurrentBank" + iii.ToString() + ".accdb"));
                        System.IO.File.Copy(Root + "\\Database\\CurrentBank.accdb", "Database\\Games\\CurrentBank" + iii.ToString() + ".accdb");
                        System.IO.File.Delete(Root + "\\Database\\CurrentBank.accdb");
                        break;

                    }
                }
                catch (Exception t)
                {
                    if (Stockfish)
                    {
                        goto Again;
                    }
                    Log(t);
                    try
                    {

                        Move++;

                        String TableName = (Move).ToString();
                        String Zero = "Table";
                        for (int i = 0; i < 8 - TableName.Length; i++)
                            Zero += "0";
                        TableName = Zero + TableName;

                        oleDbCmd.CommandText = "Select * From " + TableName;
                        OleDbDataReader dr = null;
                        dr = oleDbCmd.ExecuteReader();
                        int ii = 0;
                        while (dr.Read())
                        {
                            Tab[0, ii] = System.Convert.ToInt32(dr["a"]);
                            Tab[1, ii] = System.Convert.ToInt32(dr["b"]);
                            Tab[2, ii] = System.Convert.ToInt32(dr["c"]);
                            Tab[3, ii] = System.Convert.ToInt32(dr["d"]);
                            Tab[4, ii] = System.Convert.ToInt32(dr["e"]);
                            Tab[5, ii] = System.Convert.ToInt32(dr["f"]);
                            Tab[6, ii] = System.Convert.ToInt32(dr["g"]);
                            Tab[7, ii] = System.Convert.ToInt32(dr["h"]);
                            ii++;
                        }
                        int[,] TableA = new int[8, 8];
                        for (int i = 0; i < 8; i++)
                            for (int j = 0; j < 8; j++)
                                TableA[i, j] = Tab[i, j];

                        Draw.TableList.Clear();
                        Draw.TableList.Add(TableA);
                        Draw.SetRowColumn(0);
                        AllDraw.TableListAction.Add(TableA);
                        if (AllDraw.TableListAction.Count >= 1)
                        {
                            ChessGeneticAlgorithm R = new ChessGeneticAlgorithm(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged);
                            if (R.FindGenToModified(AllDraw.TableListAction[AllDraw.TableListAction.Count - 2], AllDraw.TableListAction[AllDraw.TableListAction.Count - 1], AllDraw.TableListAction, 0, OrderPlate, true))
                            {
                                bool HitVal = false;
                                int Hit = AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRow, R.CromosomColumn];
                                if (Hit != 0)
                                    HitVal = true;
                                bool Convert = false;
                                if (OrderPlate == 1)
                                {
                                    if (AllDraw.TableListAction[AllDraw.TableListAction.Count - 1][R.CromosomRow, R.CromosomColumn] == 1)
                                    {
                                        if (R.CromosomColumn == 7)
                                            Convert = true;
                                    }
                                    AllDraw.SyntaxToWrite = (new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged)).CreateStatistic(ArrangmentsChanged,TableA, MoveNumber + 1, AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst], R.CromosomColumn, R.CromosomRow, HitVal, Hit, ChessRules.BridgeActGray, Convert);
                                }
                                else
                                {
                                    if (AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst] == -1)
                                    {
                                        if (R.CromosomColumn == 0)
                                            Convert = true;
                                    }
                                    AllDraw.SyntaxToWrite = (new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged)).CreateStatistic(ArrangmentsChanged,TableA, MoveNumber, AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst], R.CromosomColumn, R.CromosomRow, HitVal, Hit, ChessRules.BridgeActBrown, Convert);
                                }

                            }
                        }


                        for (int i = 0; i < 8; i++)
                            for (int j = 0; j < 8; j++)
                                TableA[i, j] = Tab[i, j];


                        if ((new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,1, TableA, OrderPlate, -1, -1).CheckMate(TableA, OrderPlate)))
                        {
                            int iii = 0;
                            do { iii++; } while (System.IO.File.Exists(Root + "\\Database\\Games\\CurrentBank" + iii.ToString() + ".accdb"));
                            System.IO.File.Copy(Root + "\\Database\\CurrentBank.accdb", Root + "\\Database\\Games\\CurrentBank" + iii.ToString() + ".accdb");
                            System.IO.File.Delete(Root + "\\Database\\CurrentBank.accdb");
                            break;

                        }
                        bookConn.Close();
                        oleDbCmd.Dispose();
                    }
                    catch (Exception tt)
                    {
                        Log(tt);
                        break;
                    }
                }
                if (Move > 1)
                {
                    OrderPlate *= -1;
                    ChessRules.CurrentOrder = OrderPlate;
                }


            } while (true);
            ReadF = true;
            return Tab;


        }
        //Verify Accuarance of Table Games Methos.
        bool VerifyTable(String FileName, int Movment, ref int MoveNumber)
        {
            bool PreviouseCheck = false;

            int[,] Tab = Table;
            int Move = 1;
            int Order = 1;
            bool TowCheckFromOneKind = false;
            do
            {
                if (Move > 5000)
                    break;
                try
                {
                    if (Move % 2 == 1)
                        Order = 1;
                    else
                        Order = -1;
                    String connParam = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + FileName + ";Persist Security Info=true;Jet OLEDB:Database Password=''";
                    bookConn = new OleDbConnection(connParam);
                    bookConn.Open();
                    oleDbCmd.Connection = bookConn;
                    String TableName = Move.ToString();
                    String Zero = "Table";
                    for (int i = 0; i < 8 - TableName.Length; i++)
                        Zero += "0";
                    TableName = Zero + TableName;

                    oleDbCmd.CommandText = "Select * From " + TableName;
                    OleDbDataReader dr = null;
                    try
                    {
                        dr = oleDbCmd.ExecuteReader();
                    }
                    catch (Exception t)
                    {
                        
                        Move++;
                        break;
                    }
                    int ii = 0;
                    while (dr.Read())
                    {
                        Tab[0, ii] = System.Convert.ToInt32(dr["a"]);
                        Tab[1, ii] = System.Convert.ToInt32(dr["b"]);
                        Tab[2, ii] = System.Convert.ToInt32(dr["c"]);
                        Tab[3, ii] = System.Convert.ToInt32(dr["d"]);
                        Tab[4, ii] = System.Convert.ToInt32(dr["e"]);
                        Tab[5, ii] = System.Convert.ToInt32(dr["f"]);
                        Tab[6, ii] = System.Convert.ToInt32(dr["g"]);
                        Tab[7, ii] = System.Convert.ToInt32(dr["h"]);
                        ii++;
                    }
                    int[,] TableA = new int[8, 8];
                    for (int i = 0; i < 8; i++)
                        for (int j = 0; j < 8; j++)
                            TableA[i, j] = Tab[i, j];
                    Draw.TableList.Clear();
                    Draw.TableList.Add(TableA);
                    Draw.SetRowColumn(0);
                    if (!Draw.isEnemyThingsinStable(TableA, AllDraw.TableVeryfy, Order))
                    {
                        Tab = null;
                        Tab[0, 0] = -1;
                    }
                    else
                    {
                        for (int i = 0; i < 8; i++)
                            for (int j = 0; j < 8; j++)
                                AllDraw.TableVeryfy[i, j] = Tab[i, j];

                    }


                    bookConn.Close();
                    oleDbCmd.Dispose();
                    bookConn.Dispose();
                    Move++;
                    if (Move > 1)
                        MoveNumber++;
                    for (int i = 0; i < 8; i++)
                        for (int j = 0; j < 8; j++)
                            TableA[i, j] = Tab[i, j];

                    ChessRules A = new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,1, TableA, OrderPlate, -1, -1);
                    if (A.CheckMate(TableA, OrderPlate))
                    {

                        int iii = 0;
                        do { iii++; } while (System.IO.File.Exists(Root + "\\Database\\Games\\CurrentBank" + iii.ToString() + ".accdb"));
                        System.IO.File.Copy(Root + "\\Database\\CurrentBank.accdb", Root + "\\Database\\Games\\CurrentBank" + iii.ToString() + ".accdb");
                        System.IO.File.Delete(Root + "\\Database\\CurrentBank.accdb");
                        break;

                    }
                    if (A.CheckGray && TowCheckFromOneKind)
                    {
                        Tab = null;
                        Tab[0, 0] = -1;

                    }
                    else
                        if (Order == 1 && A.CheckGray)
                            TowCheckFromOneKind = true;
                        else
                            TowCheckFromOneKind = false;

                    if (A.CheckGray && TowCheckFromOneKind)
                    {
                        Tab = null;
                        Tab[0, 0] = -1;

                    }
                    else
                        if (Order == 1 && A.CheckGray)
                            TowCheckFromOneKind = true;
                        else
                            TowCheckFromOneKind = false;

                    if (A.CheckBrown || A.CheckGray)
                    {
                        if (PreviouseCheck)
                            return false;
                        else
                            PreviouseCheck = true;
                    }
                    else
                        PreviouseCheck = false;
                }
                catch (Exception t)
                {

                    bookConn.Close();
                    oleDbCmd.Dispose();
                    bookConn.Dispose();
                    

                    do
                    {
                        try
                        {

                            Move++;

                            String connParam = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + FileName + ";Persist Security Info=true;Jet OLEDB:Database Password=''";
                            bookConn = new OleDbConnection(connParam);
                            bookConn.Open();
                            oleDbCmd.Connection = bookConn;
                            String TableName = (Move).ToString();
                            String Zero = "Table";
                            for (int i = 0; i < 8 - TableName.Length; i++)
                                Zero += "0";
                            TableName = Zero + TableName;

                            oleDbCmd.CommandText = "Drop Table " + TableName;
                            OleDbDataReader dr = null;
                            dr = oleDbCmd.ExecuteReader();
                            bookConn.Close();
                            oleDbCmd.Dispose();
                            bookConn.Dispose();
                            //return true;

                        }
                        catch (Exception tt)
                        {
                            Log(tt);
                            bookConn.Close();
                            oleDbCmd.Dispose();
                            bookConn.Dispose();
                            return false;
                        }
                    } while (true);
                }
                if (Move > 1)
                {
                    OrderPlate *= -1;
                    ChessRules.CurrentOrder = OrderPlate;
                }


            } while (true);
            bookConn.Close();
            oleDbCmd.Dispose();
            bookConn.Dispose();

            return true;


        }
        //Read Specific Table Number.
        int[,] ReadTableMovmentNumber()
        {
            int[,] Tab = Table;
            int Move = MovmentsNumber;
            AllDraw.TableListAction.Clear();

            try
            {
                if (Move > 1)
                {
                    if (MovmentsNumber % 2 == 0)
                        OrderPlate = 1;
                    else
                        OrderPlate = -1;
                    ChessRules.CurrentOrder = OrderPlate;
                }
                String connParam = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + Root + "\\" + "Database\\CurrentBank.accdb;Persist Security Info=true;Jet OLEDB:Database Password=''";
                bookConn = new OleDbConnection(connParam);
                bookConn.Open();
                oleDbCmd.Connection = bookConn;
                String TableName = Move.ToString();
                String Zero = "Table";
                for (int i = 0; i < 8 - TableName.Length; i++)
                    Zero += "0";
                TableName = Zero + TableName;

                oleDbCmd.CommandText = "Select * From " + TableName;
                OleDbDataReader dr = null;
                dr = oleDbCmd.ExecuteReader();
                int ii = 0;
                while (dr.Read())
                {
                    Tab[0, ii] = System.Convert.ToInt32(dr["a"]);
                    Tab[1, ii] = System.Convert.ToInt32(dr["b"]);
                    Tab[2, ii] = System.Convert.ToInt32(dr["c"]);
                    Tab[3, ii] = System.Convert.ToInt32(dr["d"]);
                    Tab[4, ii] = System.Convert.ToInt32(dr["e"]);
                    Tab[5, ii] = System.Convert.ToInt32(dr["f"]);
                    Tab[6, ii] = System.Convert.ToInt32(dr["g"]);
                    Tab[7, ii] = System.Convert.ToInt32(dr["h"]);
                    ii++;
                }
                int[,] TableA = new int[8, 8];
                for (int i = 0; i < 8; i++)
                    for (int j = 0; j < 8; j++)
                        TableA[i, j] = Tab[i, j];

                AllDraw.TableListAction.Add(TableA);
                if (AllDraw.TableListAction.Count >= 1)
                {
                    ChessGeneticAlgorithm R = new ChessGeneticAlgorithm(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged);
                    if (R.FindGenToModified(AllDraw.TableListAction[AllDraw.TableListAction.Count - 2], AllDraw.TableListAction[AllDraw.TableListAction.Count - 1], AllDraw.TableListAction, 0, OrderPlate, true))
                    {
                        bool HitVal = false;
                        int Hit = AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRow, R.CromosomColumn];
                        if (Hit != 0)
                            HitVal = true;
                        bool Convert = false;
                        if (OrderPlate == 1)
                        {
                            if (AllDraw.TableListAction[AllDraw.TableListAction.Count - 1][R.CromosomRow, R.CromosomColumn] == 1)
                            {
                                if (R.CromosomColumn == 7)
                                    Convert = true;
                            }
                            AllDraw.SyntaxToWrite = (new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged)).CreateStatistic(ArrangmentsChanged,TableA, MovmentsNumber, AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst], R.CromosomColumn, R.CromosomRow, HitVal, Hit, ChessRules.BridgeActGray, Convert);
                        }
                        else
                        {
                            if (AllDraw.TableListAction[AllDraw.TableListAction.Count - 1][R.CromosomRowFirst, R.CromosomColumnFirst] == -1)
                            {
                                if (R.CromosomColumn == 0)
                                    Convert = true;
                            }
                            AllDraw.SyntaxToWrite = (new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged)).CreateStatistic(ArrangmentsChanged,TableA, MovmentsNumber, AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst], R.CromosomColumn, R.CromosomRow, HitVal, Hit, ChessRules.BridgeActBrown, Convert);
                        }
                        //SetBoxStatistic(AllDraw.SyntaxToWrite);
                        //RefreshBoxStatistic();
                    }
                }


                bookConn.Close();
                oleDbCmd.Dispose();
                bookConn.Dispose();
                Move++;

                if ((new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,1, Tab, OrderPlate, -1, -1).CheckMate(Tab, OrderPlate)))
                {
                    int iii = 0;
                    do { iii++; } while (System.IO.File.Exists(Root + "\\Database\\Games\\CurrentBank" + iii.ToString() + ".accdb"));
                    System.IO.File.Copy(Root + "\\Database\\CurrentBank.accdb", Root + "\\Database\\Games\\CurrentBank" + iii.ToString() + ".accdb");
                    System.IO.File.Delete(Root + "\\Database\\CurrentBank.accdb");
                    return TableA;

                }
            }
            catch (Exception t)
            {
                
                try
                {
                    bookConn.Close();
                    oleDbCmd.Dispose();
                    bookConn.Dispose();

                    Move++;

                    String connParam = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + Root + "\\" + "Database\\CurrentBank.accdb;Persist Security Info=true;Jet OLEDB:Database Password=''";
                    bookConn = new OleDbConnection(connParam);
                    bookConn.Open();
                    oleDbCmd.Connection = bookConn;
                    String TableName = (Move).ToString();
                    String Zero = "Table";
                    for (int i = 0; i < 8 - TableName.Length; i++)
                        Zero += "0";
                    TableName = Zero + TableName;

                    oleDbCmd.CommandText = "Select * From " + TableName;
                    OleDbDataReader dr = null;
                    dr = oleDbCmd.ExecuteReader();
                    int ii = 0;
                    while (dr.Read())
                    {
                        Tab[0, ii] = System.Convert.ToInt32(dr["a"]);
                        Tab[1, ii] = System.Convert.ToInt32(dr["b"]);
                        Tab[2, ii] = System.Convert.ToInt32(dr["c"]);
                        Tab[3, ii] = System.Convert.ToInt32(dr["d"]);
                        Tab[4, ii] = System.Convert.ToInt32(dr["e"]);
                        Tab[5, ii] = System.Convert.ToInt32(dr["f"]);
                        Tab[6, ii] = System.Convert.ToInt32(dr["g"]);
                        Tab[7, ii] = System.Convert.ToInt32(dr["h"]);
                        ii++;
                    }
                    int[,] TableA = new int[8, 8];
                    for (int i = 0; i < 8; i++)
                        for (int j = 0; j < 8; j++)
                            TableA[i, j] = Tab[i, j];

                    AllDraw.TableListAction.Add(TableA);
                    if (AllDraw.TableListAction.Count >= 1)
                    {
                        ChessGeneticAlgorithm R = new ChessGeneticAlgorithm(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged);
                        if (R.FindGenToModified(AllDraw.TableListAction[AllDraw.TableListAction.Count - 2], AllDraw.TableListAction[AllDraw.TableListAction.Count - 1], AllDraw.TableListAction, 0, OrderPlate, true))
                        {
                            bool HitVal = false;
                            int Hit = AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRow, R.CromosomColumn];
                            if (Hit != 0)
                                HitVal = true;
                            bool Convert = false;
                            if (OrderPlate == 1)
                            {
                                if (AllDraw.TableListAction[AllDraw.TableListAction.Count - 1][R.CromosomRow, R.CromosomColumn] == 1)
                                {
                                    if (R.CromosomColumn == 7)
                                        Convert = true;
                                }
                                AllDraw.SyntaxToWrite = (new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged)).CreateStatistic(ArrangmentsChanged,TableA, MovmentsNumber, AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst], R.CromosomColumn, R.CromosomRow, HitVal, Hit, ChessRules.BridgeActGray, Convert);
                            }
                            else
                            {
                                if (AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst] == -1)
                                {
                                    if (R.CromosomColumn == 0)
                                        Convert = true;
                                }
                                AllDraw.SyntaxToWrite = (new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged)).CreateStatistic(ArrangmentsChanged,TableA, MovmentsNumber, AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst], R.CromosomColumn, R.CromosomRow, HitVal, Hit, ChessRules.BridgeActBrown, Convert);
                            }
                            //SetBoxStatistic(AllDraw.SyntaxToWrite);
                            //RefreshBoxStatistic();
                        }
                    }

                    bookConn.Close();
                    oleDbCmd.Dispose();
                    bookConn.Dispose();
                    if ((new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged,1, Tab, OrderPlate, -1, -1).CheckMate(Tab, OrderPlate)))
                    {
                        int iii = 0;
                        do { iii++; } while (System.IO.File.Exists("Database\\Games\\CurrentBank" + iii.ToString() + ".accdb"));
                        System.IO.File.Copy("Database\\CurrentBank.accdb", Root + "\\Database\\Games\\CurrentBank" + iii.ToString() + ".accdb");
                        System.IO.File.Delete("Database\\CurrentBank.accdb");
                        return TableA; ;

                    }

                }
                catch (Exception tt)
                {
                    Log(tt);
                    bookConn.Close();
                    oleDbCmd.Dispose();
                    bookConn.Dispose();
                    return null;
                }
            }



            return Tab;


        }
        //Creation of New Tables at DatabaseMethod.
        String CreatTable()
        {
        Begin12:
            try
            {
                String connParam = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + Root + "\\" + "Database\\CurrentBank.accdb;Persist Security Info=true;Jet OLEDB:Database Password=''";

                bookConn = new OleDbConnection(connParam);
                bookConn.Open();
                oleDbCmd.Connection = bookConn;
                String TableName = MovmentsNumber.ToString();
                String Zero = "Table";
                for (int i = 0; i < 8 - TableName.Length; i++)
                    Zero += "0";
                TableName = Zero + TableName;

                oleDbCmd.CommandText = "Create Table " + TableName + " (a Number NOT NULL,b Number NOT NULL,c Number NOT NULL,d Number NOT NULL,e Number NOT NULL,f Number NOT NULL,g Number NOT NULL,h Number NOT NULL)";
                int temp = 0;
                temp = oleDbCmd.ExecuteNonQuery();
                bookConn.Close();
                oleDbCmd.Dispose();
                bookConn.Dispose();
                return TableName;
            }
            catch (Exception t)
            {
                
                String connParam = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + Root + "\\" + "Database\\CurrentBank.accdb;Persist Security Info=true;Jet OLEDB:Database Password=''";

                bookConn = new OleDbConnection(connParam);
                bookConn.Open();
                oleDbCmd.Connection = bookConn;
                String TableName = MovmentsNumber.ToString();
                String Zero = "Table";
                for (int i = 0; i < 8 - TableName.Length; i++)
                    Zero += "0";
                TableName = Zero + TableName;

                oleDbCmd.CommandText = "Drop Table " + TableName;
                int temp = 0;
                temp = oleDbCmd.ExecuteNonQuery();
                bookConn.Close();
                oleDbCmd.Dispose();
                bookConn.Dispose();
                goto Begin12;

            }
        }
        //Creatiopn of Configuration Table
        public void CreateConfigurationTable()
        {
            if (bookConn == null)
            {
                String connParam = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + Root + "\\" + "Database\\CurrentBank.accdb;Persist Security Info=true;Jet OLEDB:Database Password=''";
                bookConn = new OleDbConnection(connParam);
                bookConn.Open();
                oleDbCmd.Connection = bookConn;
            }

            if (!AllDrawLoad)
            {
            Begin12:
                try
                {

                    oleDbCmd.CommandText = "Create Table Configuration (ArrangmentsChanged Number NOT NULL,GrayTimer Number NOT NULL,BrownTimer Number NOT NULL,BobSection Number NOT NULL,AliceSection Number NOT NULL,StateCP Number NOT NULL,StateCC Number NOT NULL,StateGe Number NOT NULL,Blitz Number NOT NULL,Person Number NOT NULL,SettingPRFALSE Number NOT NULL)";
                    int temp = 0;
                    temp = oleDbCmd.ExecuteNonQuery();

                    oleDbCmd.CommandText = "Insert into Configuration (ArrangmentsChanged,GrayTimer,BrownTimer,BobSection,AliceSection,StateCP,StateCC,StateGe,Blitz,Person,SettingPRFALSE) values(" + System.Convert.ToInt32(ArrangmentsChanged).ToString() + "," + GrayTimer.Times.ToString() + "," + BrownTimer.Times.ToString() + "," + System.Convert.ToInt32(BobSection).ToString() + "," + System.Convert.ToInt32(AliceSection).ToString() + "," + System.Convert.ToInt32(StateCP).ToString() + "," + System.Convert.ToInt32(StateCC).ToString() + "," + System.Convert.ToInt32(StateGe).ToString() + "," + System.Convert.ToInt32(Blitz).ToString() + "," + System.Convert.ToInt32(Person).ToString() + "," + System.Convert.ToInt32(SettingPRFALSE).ToString() + ")";

                    temp = oleDbCmd.ExecuteNonQuery();

                }
                catch (Exception t)
                {
                    Log(t);
                    oleDbCmd.CommandText = "Drop Table Configuration";
                    int temp = 0;
                    temp = oleDbCmd.ExecuteNonQuery();
                    goto Begin12;

                }
            }
        }
        void UpdateTable(int[,] Tabl, String TableName)
        {
            //if (UpdateConfigurationTableVal)
            {
            Begin121:
                try
                {
                    oleDbCmd.CommandText = "Drop Table " + TableName;
                    int temp = 0;
                    temp = oleDbCmd.ExecuteNonQuery();
                    InsertTableAtDataBase(Tabl);

                }
                catch (Exception t)
                {
                    Log(t);
                }
            }
        }

        //Reading of Configuration Table Method.
        void ReadConfigurationTable()
        {

            if (!AllDrawLoad)
            {
            Begin12:
                try
                {

                    oleDbCmd.CommandText = "Select * from Configuration";
                    OleDbDataReader dr = null;
                    dr = oleDbCmd.ExecuteReader();
                    if (dr.Read())
                    {
                        ArrangmentsChanged = System.Convert.ToBoolean(dr["ArrangmentsChanged"]);
                        GrayTimer.Times = System.Convert.ToInt64(dr["GrayTimer"]);
                        BrownTimer.Times = System.Convert.ToInt64(dr["BrownTimer"]);
                        BobSection = System.Convert.ToBoolean(dr["BobSection"]);
                        AliceSection = System.Convert.ToBoolean(dr["AliceSection"]);
                        StateCP = System.Convert.ToBoolean(dr["StateCP"]);
                        StateCC = System.Convert.ToBoolean(dr["StateCC"]);
                        StateGe = System.Convert.ToBoolean(dr["StateGe"]);
                        Blitz = System.Convert.ToBoolean(dr["Blitz"]);
                        Person = System.Convert.ToBoolean(dr["Person"]);
                        SettingPRFALSE = System.Convert.ToBoolean(dr["SettingPRFALSE"]);
                    }

                }
                catch (Exception t)
                {
                    Log(t);
                    try
                    {
                        oleDbCmd.CommandText = "Drop Table Configuration";
                        int temp = 0;
                        temp = oleDbCmd.ExecuteNonQuery();
                    }
                    catch (Exception tt)
                    {
                        Log(tt);
                        CreateConfigurationTable();

                    }
                    goto Begin12;

                }
            }
        }
        //Updating of Configuration Method.
        void UpdateConfigurationTable()
        {

            //if (UpdateConfigurationTableVal)
            {

            Begin12:
                try
                {
                    TimersSet = false;

                    oleDbCmd.CommandText = "Update Configuration Set ArrangmentsChanged=" + System.Convert.ToString(System.Convert.ToInt32(ArrangmentsChanged)) + ",GrayTimer=" + GrayTimer.Times.ToString() + ",BrownTimer=" + BrownTimer.Times.ToString() + ",BobSection = " + System.Convert.ToUInt32(BobSection).ToString() + ",AliceSection =" + System.Convert.ToUInt32(AliceSection).ToString() + ",StateCP = " + System.Convert.ToUInt32(StateCP).ToString() + ",StateCC = " + System.Convert.ToUInt32(StateCC).ToString() + ",StateGe=" + System.Convert.ToUInt32(StateGe).ToString() + ",Blitz=" + System.Convert.ToUInt32(Blitz).ToString() + ",Person=" + System.Convert.ToUInt32(Person).ToString() + ",SettingPRFALSE=" + System.Convert.ToUInt32(SettingPRFALSE).ToString();

                    int temp = oleDbCmd.ExecuteNonQuery();
                    TimersSet = true;
                }
                catch (Exception t)
                {
                    //TimersSet = true;
                    Log(t);
                    try
                    {
                        oleDbCmd.CommandText = "Drop Table Configuration";
                        int temp = 0;
                        temp = oleDbCmd.ExecuteNonQuery();
                        goto Begin12;
                    }
                    catch (Exception tt)
                    {
                        Log(tt);

                    }

                }
            }
        }
        //Inserting of New Tabler at Database.
        public void InsertTableAtDataBase(int[,] Table)
        {
            String connParam = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" + Root + "\\" + "Database\\CurrentBank.accdb;Persist Security Info=true;Jet OLEDB:Database Password=''";
                    MovmentsNumber++;
            

            //TimersSet = false;
            int[,] Tab = new int[8, 8];
            for (int i = 0; i < 8; i++)
                for (int j = 0; j < 8; j++)
                    Tab[i, j] = Table[i, j];
            String TableName = CreatTable();
            for (int i = 0; i < 8; i++)
            {
                if (bookConn != null)
                {
                    bookConn.Close();
                    bookConn.Dispose();
                    oleDbCmd.Dispose();
                }
                bookConn = new OleDbConnection(connParam);
                bookConn.Open();
                oleDbCmd.Connection = bookConn;
                oleDbCmd.CommandText = "insert into " + TableName + "(a,b,c,d,e,f,g,h)  values (" + Tab[0, i].ToString() + "," + Tab[1, i].ToString() + "," + Tab[2, i].ToString() + "," + Tab[3, i].ToString() + "," + Tab[4, i].ToString() + "," + Tab[5, i].ToString() + "," + Tab[6, i].ToString() + "," + Tab[7, i].ToString() + ")";
                int temp = 0;
                temp = oleDbCmd.ExecuteNonQuery();

            }
            MaxCurrentMovmentsNumber++;
            if (MovmentsNumber > 1)
                GameStarted = true;
            //ChessRules.BridgeActBrown = false;
            //ChessRules.BridgeActGray = false;
            //TimersSet = true;

        }
        void L()
        {
            do
            {
                ArrangmentsChanged = true;
                System.Threading.Thread.Sleep(30);
            } while (true);
        }
        public void Load()
        {
            ttt = new WebApplicationRefregitzTow._Default();
            //ttt.Iniziate();
            //GC.Collect();
            //GC.WaitForPendingFinalizers();
            Thread tSPHT = new Thread(new ThreadStart(L));
            tSPHT.Start();

            ThinkingA = true;
            ReadConfigurationTable();
            Table = ReadTable(0, ref MovmentsNumber);

            while (!ReadF) ;


            //GC.Collect();
            //GC.WaitForPendingFinalizers();
            LoadPlaceHolder = true;
            // ttt.LoadPlaceHolder(); 
            //System.Threading.Thread.Sleep(3000);
            do
            {
                //LoadPlaceHolder = false;
                if (OrderPlate == 1)
                {
                    WebApplicationRefregitzTow._Default.No = 0;
                    ThinkingA = false;
                    WebApplicationRefregitzTow.Controls_CBC.MouseClicked = 0;
                    WebApplicationRefregitzTow.Controls_CBC.Found = false;
                    WebApplicationRefregitzTow.Controls_CBC.CurrentClickedNumber = 0;
                    while (!(ThinkingA))
                    {
                        //LoadPlaceHolder = false;
                        //PlaceHolderBreak=true;
                        //Thread tSPHT = new Thread(new ThreadStart(SetLoadPlaceHoldertrue));
                        //tSPHT.Start();
                        //ttt.LoadPlaceHolder();
                    }

                    int[,] Tab = new int[8, 8];
                    for (int i = 0; i < 8; i++)
                        for (int j = 0; j < 8; j++)
                            Tab[i, j] = Table[i, j];
                    OrderPlate *= -1;
                    ChessRules.CurrentOrder *= -1;
                    Draw.TableList.Clear();
                    Draw.TableList.Add(Tab);
                    Draw.SetRowColumn(0);
                    RefrigtzW.AllDraw.TableListAction.Add(Tab);
                    //RefrigtzW.FormRefrigtz.MovmentsNumber++; 
                    InsertTableAtDataBase(Tab);
                    //ttt.AddBPOP();
                    //LoadPlaceHolder = true;
                    using (SoundPlayer soundClick = new SoundPlayer(Root + "\\Music\\Click6.wav"))
                    {
                        soundClick.Play();
                        soundClick.Dispose();
                    }
                    //LoadPlaceHolder = true; 
                    //PlaceHolderBreak = true;
                    //Thread tSPHTT = new Thread(new ThreadStart(SetLoadPlaceHoldertrue));
                    //tSPHTT.Start();


                }
                else
                {
                    LoadPlaceHolder = false;

                    ThinkingA = true;
                    t1 = new Thread(new ThreadStart(AliceWithPerson));
                    //Thread tSPHT = new Thread(new ThreadStart(SetLoadPlaceHoldertrue));
                    //PlaceHolderBreak = false;
                    //tSPHT.Start();
                    t1.Start();

                    t1.Join();
                    if (IsPenaltyRegardCanceled)
                    {
                        SettingPRFALSE = true;
                        UsePenaltyRegardMechnisam = false;
                        UpdateConfigurationTable();
                        t1 = new Thread(new ThreadStart(AliceWithPerson));
                        //Thread tSPHT = new Thread(new ThreadStart(SetLoadPlaceHoldertrue));
                        //PlaceHolderBreak = false;
                        //tSPHT.Start();
                        t1.Start();
                        t1.Join();
                        SettingPRFALSE = false;
                        UsePenaltyRegardMechnisam = true;
                        UpdateConfigurationTable();
                        IsPenaltyRegardCanceled = false;

                    }
                    else
                    {
                        //tSPHT.Abort();
                        // LoadPlaceHolder = true;
                        //OrderPlate = OrderPlate * -1;
                        // ChessRules.CurrentOrder = OrderPlate;
                        //t1.Abort();
                        //  while (ThinkingA)
                        //{
                        //  Thread.Sleep(1000);
                        //}
                        LoadPlaceHolder = true;
                        FormRefrigtz.ThinkingA = false;
                        //Thread tSPHT = new Thread(new ThreadStart(SetLoadPlaceHoldertrue));
                        //PlaceHolderBreak = false;
                        //tSPHT.Start();
                        //System.Web.HttpContext.Current.Response.AppendHeader("Refresh", 30 + "; URL=~/Default.aspx");   
                        ttt.LoadPlaceHolder();
                    }
                }
            } while (true);
        }
        //Inserting of New Tabler at Database.
        
        void Wait()
        {
            do
            {
                Thread.Sleep(100);
            } while (Clicked);
        }
        //All Operation of Thinking Handling.
         
        //The State of Alice with Person Thinking.
        void AliceWithPerson()
        {

            ThinkingChess.ThinkingRun = true;

            try
            {
            Begin1:
                bool StoreStateCC = StateCC;
                bool StoreStateCP = StateCP;
                bool StoreStateGe = StateGe;
                StateCC = false;
                StateCP = false;
                StateGe = false;

                MovmentsNumber++;

                ////SetBoxText("\r\n Movments Number " + MovmentsNumber.ToString() + " is Brown OrderPlate!");
                ////RefreshBoxText();();

                ////SetBoxText("\r\nThinking Begin!");
                ////RefreshBoxText();();
                Color a = Color.Gray;
                if (OrderPlate == -1)
                    a = Color.Brown;
                Draw.Initiate(1, 4, a, Table, OrderPlate, false,false);
                //this.//SetBoxText("\r\nThinking Finished!");
                try
                {
                    Table = Draw.TableList[0];
                    if (!TableZero(Table))
                    {
                        SettingPRFALSE = true;
                        UpdateConfigurationTable();
                        System.IO.File.AppendAllText("CheckSum.btt", "\n\tInstallation Begine On " + DateTime.Now.ToString());
                        String FolderLocation = Root;
                        int exitCode = 0;

                        // Prepare the process to run
                        ProcessStartInfo start = new ProcessStartInfo();
                        // Prepare the process to run
                        // Enter in the command line arguments, everything you would enter after the executable name itself
                        start.Arguments = "";
                        // Enter the executable to run, including the complete path
                        start.FileName = "\"" + FolderLocation + "\\" + "LoadRP.exe" + "\"";
                        // Do you want to show a console window?
                        start.WindowStyle = ProcessWindowStyle.Normal;
                        start.CreateNoWindow = true;
                        start.UseShellExecute = true;

                        // Run the external process & wait for it to finish
                        using (Process proc = Process.Start(start))
                        {
                            proc.WaitForExit(20000);
                            // Retrieve the app's exit code
                            exitCode = proc.ExitCode;
                        }
                       
                    }

                }
                catch (Exception t)
                {
                    
                    goto Begin1;
                }

                Draw.SetRowColumn(0);
                int[,] TableCon = new int[8, 8];
                for (int i = 0; i < 8; i++)
                    for (int j = 0; j < 8; j++)
                        TableCon[i, j] = Table[i, j];
                AllDraw.TableListAction.Add(TableCon);
                if (AllDraw.TableListAction.Count > 1)
                {
                    ChessGeneticAlgorithm R = new ChessGeneticAlgorithm(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged);
                    if (R.FindGenToModified(AllDraw.TableListAction[AllDraw.TableListAction.Count - 2], AllDraw.TableListAction[AllDraw.TableListAction.Count - 1], AllDraw.TableListAction, 0, OrderPlate, true))
                    {
                        bool HitVal = false;
                        int Hit = AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRow, R.CromosomColumn];
                        if (Hit != 0)
                            HitVal = true;
                        bool Convert = false;
                        if (OrderPlate == 1)
                        {
                            if (AllDraw.TableListAction[AllDraw.TableListAction.Count - 1][R.CromosomRow, R.CromosomColumn] == 1)
                            {
                                if (R.CromosomColumn == 7)
                                    Convert = true;
                            }
                            if ((ChessRules.SmallKingBridgeGray || ChessRules.BigKingBridgeGray) && (!ChessRules.BridgeActGray))
                                ChessRules.BridgeActGray = true;
                            AllDraw.SyntaxToWrite = (new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged)).CreateStatistic(ArrangmentsChanged,Table, MovmentsNumber + 1, AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst], R.CromosomColumn, R.CromosomRow, HitVal, Hit, ChessRules.BridgeActGray, Convert);
                        }
                        else
                        {
                            if (AllDraw.TableListAction[AllDraw.TableListAction.Count - 1][R.CromosomRow, R.CromosomColumn] == -1)
                            {
                                if (R.CromosomColumn == 0)
                                    Convert = true;
                            }
                            if ((ChessRules.SmallKingBridgeBrown || ChessRules.BigKingBridgeBrown) && (!ChessRules.BridgeActBrown))
                                ChessRules.BridgeActBrown = true;

                            AllDraw.SyntaxToWrite = (new ChessRules(MovementsAStarGreedyHuristicFound,IInoreSelfObjects,UsePenaltyRegardMechnisam,BestMovments,PredictHuristic,OnlySelf,AStarGreedyHuristic,ArrangmentsChanged)).CreateStatistic(ArrangmentsChanged,Table, MovmentsNumber + 1, AllDraw.TableListAction[AllDraw.TableListAction.Count - 2][R.CromosomRowFirst, R.CromosomColumnFirst], R.CromosomColumn, R.CromosomRow, HitVal, Hit, ChessRules.BridgeActBrown, Convert);
                        }
                        //SetBoxStatistic(AllDraw.SyntaxToWrite);
                        //RefreshBoxStatistic();
                    }
                }
                OrderPlate = OrderPlate * -1;
                ChessRules.CurrentOrder = OrderPlate;

                BrownTimer.StopTime();
                GrayTimer.StartTime();
                InsertTableAtDataBase(Table);
                using (SoundPlayer soundClick = new SoundPlayer(Root + "\\Music\\Click6.wav"))
                {
                    soundClick.Play();
                    soundClick.Dispose();
                }

                
                Person = true;
                StateCC = StoreStateCC;
                StateCP = StoreStateCP;
                StateGe = StoreStateGe;
                ThinkingChess.ThinkingRun = false;
                if (SettingPRFALSE)
                {
                    SettingPRFALSE = false;
                    UpdateConfigurationTable();
                }
            }
            catch (Exception t)
            {
                
                //this.//SetBoxText("\r\nError!");
            }
        }
        //The State of Bob with Person Thinking.
        public bool TableZero(int[,] Ta)
        {
            bool NotZerro = false;
            for (int i = 0; i < 8; i++)
                for (int j = 0; j < 8l; j++)
                    if (Ta[i, j] != 0)
                        NotZerro = true;
            return NotZerro;
        }
        //Alice Section of Computer by Computer Thinking.
        //Bob Section of Computer By Computer Thinking.
        
    }
  

}

//End of Documentation.




